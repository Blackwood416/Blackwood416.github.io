---
title: 操作系统开发日志 02
date: 2023-01-06 16:57:14
tags: 操作系统
---

# 操作系统开发日志 02

从本篇开始我们开始正式设计和实现一个操作系统。

# 从哪里开始，到哪里结束

我们要开发的是一个可以在物理平台上运行的操作系统，虽说在开发与调试的过程中我们要使用虚拟机的形式启动，但是后面我们预定接入UEFI支持。而这个操作系统应该是个完整的操作系统，包含了系统的内核和系统应用，所以我们为了能在调试用的虚拟机里运行这个系统，我们得先为这个操作系统编写一个BootLoader。

# BootLoader开发

## Boot引导程序

计算机上电启动后，首先会经过BIOS上电自检。这时BIOS检测设备硬件是否存在问题，若没有，则将根据BIOS的启动项配置选择引导设备，目前BIOS支持的设备启动项有软盘启动、U盘启动、硬盘启动以及网络启动。一般BIOS会选择硬盘作为默认启动项，但我们先从软盘启动入手，后续加入U盘启动的支持。
## BIOS引导原理

当BIOS自检结束后会根据根据启动选项设置（这里指软驱启动）去选择启动设备，即检测软盘的第0磁头第0磁道第1扇区，是否以数值0x55和0xaa这两个字节作为结尾。如果是，则BIOS认为这个扇区是一个Boot Sector（引导扇区），进而把该扇区的数据复制到物理内存地址0x7c00处，随后将处理器的执行权移交给这段程序（跳转至0x7c00）地址处进行。

对于一个经典3.5英寸的1.44 MB的软盘而言，一个扇区的容量只有512 B,而且BIOS只负责加载这一个扇区的数据到物理内存中，512 B装不下一整个操作系统，甚至连获取硬件信息的检测程序都装不下，所以Boot引导程序只能作为一级助推器，将功能更强大的引导加载程序Loader加载到内存中，这也可以看作是硬件向软件移交控制权。一旦Loader引导加载程序开始执行，那么一切都交由我们编写的软件来控制。

